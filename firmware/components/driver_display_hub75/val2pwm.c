#ifndef DRIVER_HUB75_DMA_DATA_TEST
#include <sdkconfig.h>
#else
#define CONFIG_DRIVER_HUB75_ENABLE
#endif

#ifdef CONFIG_DRIVER_HUB75_ENABLE

// Copyright 2017 Espressif Systems (Shanghai) PTE LTD
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


#include <stdint.h>
#include "include/val2pwm.h"

//C/p'ed from https://ledshield.wordpress.com/2012/11/13/led-brightness-to-your-eye-gamma-correction-no/
/*
import math
a=[
    65535,    65508,    65479,    65451,    65422,    65394,    65365,    65337,
    65308,    65280,    65251,    65223,    65195,    65166,    65138,    65109,
    65081,    65052,    65024,    64995,    64967,    64938,    64909,    64878,
    64847,    64815,    64781,    64747,    64711,    64675,    64637,    64599,
    64559,    64518,    64476,    64433,    64389,    64344,    64297,    64249,
    64200,    64150,    64099,    64046,    63992,    63937,    63880,    63822,
    63763,    63702,    63640,    63577,    63512,    63446,    63379,    63310,
    63239,    63167,    63094,    63019,    62943,    62865,    62785,    62704,
    62621,    62537,    62451,    62364,    62275,    62184,    62092,    61998,
    61902,    61804,    61705,    61604,    61501,    61397,    61290,    61182,
    61072,    60961,    60847,    60732,    60614,    60495,    60374,    60251,
    60126,    59999,    59870,    59739,    59606,    59471,    59334,    59195,
    59053,    58910,    58765,    58618,    58468,    58316,    58163,    58007,
    57848,    57688,    57525,    57361,    57194,    57024,    56853,    56679,
    56503,    56324,    56143,    55960,    55774,    55586,    55396,    55203,
    55008,    54810,    54610,    54408,    54203,    53995,    53785,    53572,
    53357,    53140,    52919,    52696,    52471,    52243,    52012,    51778,
    51542,    51304,    51062,    50818,    50571,    50321,    50069,    49813,
    49555,    49295,    49031,    48764,    48495,    48223,    47948,    47670,
    47389,    47105,    46818,    46529,    46236,    45940,    45641,    45340,
    45035,    44727,    44416,    44102,    43785,    43465,    43142,    42815,
    42486,    42153,    41817,    41478,    41135,    40790,    40441,    40089,
    39733,    39375,    39013,    38647,    38279,    37907,    37531,    37153,
    36770,    36385,    35996,    35603,    35207,    34808,    34405,    33999,
    33589,    33175,    32758,    32338,    31913,    31486,    31054,    30619,
    30181,    29738,    29292,    28843,    28389,    27932,    27471,    27007,
    26539,    26066,    25590,    25111,    24627,    24140,    23649,    23153,
    22654,    22152,    21645,    21134,    20619,    20101,    19578,    19051,
    18521,    17986,    17447,    16905,    16358,    15807,    15252,    14693,
    14129,    13562,    12990,    12415,    11835,    11251,    10662,    10070,
    9473,    8872,    8266,    7657,    7043,    6424,    5802,    5175,
    4543,    3908,    3267,    2623,    1974,    1320,    662,    0]

b=[ int(((0xffff-x)*0x10001+.5)/65535) for x in a ]
for ix in range(0,256,8):
    print(''.join("{:10d},".format(x) for x in b[ix:ix+8]))
*/

const uint32_t lumConvTab[]={
         0,        27,        56,        84,       113,       141,       170,       198,
       227,       255,       284,       312,       340,       369,       397,       426,
       454,       483,       511,       540,       568,       597,       626,       657,
       688,       720,       754,       788,       824,       860,       898,       936,
       976,      1017,      1059,      1102,      1146,      1191,      1238,      1286,
      1335,      1385,      1436,      1489,      1543,      1598,      1655,      1713,
      1772,      1833,      1895,      1958,      2023,      2089,      2156,      2225,
      2296,      2368,      2441,      2516,      2592,      2670,      2750,      2831,
      2914,      2998,      3084,      3171,      3260,      3351,      3443,      3537,
      3633,      3731,      3830,      3931,      4034,      4138,      4245,      4353,
      4463,      4574,      4688,      4803,      4921,      5040,      5161,      5284,
      5409,      5536,      5665,      5796,      5929,      6064,      6201,      6340,
      6482,      6625,      6770,      6917,      7067,      7219,      7372,      7528,
      7687,      7847,      8010,      8174,      8341,      8511,      8682,      8856,
      9032,      9211,      9392,      9575,      9761,      9949,     10139,     10332,
     10527,     10725,     10925,     11127,     11332,     11540,     11750,     11963,
     12178,     12395,     12616,     12839,     13064,     13292,     13523,     13757,
     13993,     14231,     14473,     14717,     14964,     15214,     15466,     15722,
     15980,     16240,     16504,     16771,     17040,     17312,     17587,     17865,
     18146,     18430,     18717,     19006,     19299,     19595,     19894,     20195,
     20500,     20808,     21119,     21433,     21750,     22070,     22393,     22720,
     23049,     23382,     23718,     24057,     24400,     24745,     25094,     25446,
     25802,     26160,     26522,     26888,     27256,     27628,     28004,     28382,
     28765,     29150,     29539,     29932,     30328,     30727,     31130,     31536,
     31946,     32360,     32778,     33198,     33623,     34050,     34482,     34917,
     35355,     35798,     36244,     36693,     37147,     37604,     38065,     38529,
     38997,     39470,     39946,     40425,     40909,     41396,     41887,     42383,
     42882,     43384,     43891,     44402,     44917,     45435,     45958,     46485,
     47015,     47550,     48089,     48631,     49178,     49729,     50284,     50843,
     51407,     51974,     52546,     53121,     53701,     54285,     54874,     55466,
     56063,     56664,     57270,     57879,     58493,     59112,     59734,     60361,
     60993,     61628,     62269,     62913,     63562,     64216,     64874,     65537,
};


uint16_t valToPwm12(int val, int brightness) {
    if (val<0) val=0;
    if (val>255) val=255;
    return ((uint32_t)brightness*lumConvTab[val])>>20;
}

#endif

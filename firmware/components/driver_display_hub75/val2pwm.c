#ifndef DRIVER_HUB75_DMA_DATA_TEST
#include <sdkconfig.h>
#else
#define CONFIG_DRIVER_HUB75_ENABLE
#endif

#ifdef CONFIG_DRIVER_HUB75_ENABLE

// Copyright 2017 Espressif Systems (Shanghai) PTE LTD
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


#include <stdint.h>
#include "include/val2pwm.h"

//C/p'ed from https://ledshield.wordpress.com/2012/11/13/led-brightness-to-your-eye-gamma-correction-no/
/*
import math
a=[
    65535,    65508,    65479,    65451,    65422,    65394,    65365,    65337,
    65308,    65280,    65251,    65223,    65195,    65166,    65138,    65109,
    65081,    65052,    65024,    64995,    64967,    64938,    64909,    64878,
    64847,    64815,    64781,    64747,    64711,    64675,    64637,    64599,
    64559,    64518,    64476,    64433,    64389,    64344,    64297,    64249,
    64200,    64150,    64099,    64046,    63992,    63937,    63880,    63822,
    63763,    63702,    63640,    63577,    63512,    63446,    63379,    63310,
    63239,    63167,    63094,    63019,    62943,    62865,    62785,    62704,
    62621,    62537,    62451,    62364,    62275,    62184,    62092,    61998,
    61902,    61804,    61705,    61604,    61501,    61397,    61290,    61182,
    61072,    60961,    60847,    60732,    60614,    60495,    60374,    60251,
    60126,    59999,    59870,    59739,    59606,    59471,    59334,    59195,
    59053,    58910,    58765,    58618,    58468,    58316,    58163,    58007,
    57848,    57688,    57525,    57361,    57194,    57024,    56853,    56679,
    56503,    56324,    56143,    55960,    55774,    55586,    55396,    55203,
    55008,    54810,    54610,    54408,    54203,    53995,    53785,    53572,
    53357,    53140,    52919,    52696,    52471,    52243,    52012,    51778,
    51542,    51304,    51062,    50818,    50571,    50321,    50069,    49813,
    49555,    49295,    49031,    48764,    48495,    48223,    47948,    47670,
    47389,    47105,    46818,    46529,    46236,    45940,    45641,    45340,
    45035,    44727,    44416,    44102,    43785,    43465,    43142,    42815,
    42486,    42153,    41817,    41478,    41135,    40790,    40441,    40089,
    39733,    39375,    39013,    38647,    38279,    37907,    37531,    37153,
    36770,    36385,    35996,    35603,    35207,    34808,    34405,    33999,
    33589,    33175,    32758,    32338,    31913,    31486,    31054,    30619,
    30181,    29738,    29292,    28843,    28389,    27932,    27471,    27007,
    26539,    26066,    25590,    25111,    24627,    24140,    23649,    23153,
    22654,    22152,    21645,    21134,    20619,    20101,    19578,    19051,
    18521,    17986,    17447,    16905,    16358,    15807,    15252,    14693,
    14129,    13562,    12990,    12415,    11835,    11251,    10662,    10070,
    9473,    8872,    8266,    7657,    7043,    6424,    5802,    5175,
    4543,    3908,    3267,    2623,    1974,    1320,    662,    0]

b=[ int(((0xffff-x)*0x10001+.5)/30) for x in a ]
for ix in range(0,256,8):
    print(''.join("{:10d},".format(x) for x in b[ix:ix+8]))
*/

const uint32_t lumConvTab[]={
         0,     58983,    122335,    183503,    246856,    308023,    371376,    432544,
    495896,    557064,    620416,    681584,    742752,    806105,    867272,    930625,
    991793,   1055145,   1116313,   1179666,   1240833,   1304186,   1367538,   1435260,
   1502981,   1572888,   1647163,   1721438,   1800082,   1878727,   1961740,   2044754,
   2132137,   2221704,   2313456,   2407392,   2503513,   2601818,   2704493,   2809352,
   2916396,   3025624,   3137037,   3252819,   3370786,   3490937,   3615457,   3742162,
   3871052,   4004310,   4139753,   4277381,   4419378,   4563559,   4709925,   4860660,
   5015765,   5173053,   5332527,   5496369,   5662396,   5832793,   6007558,   6184508,
   6365827,   6549330,   6737203,   6927260,   7121687,   7320482,   7521463,   7726812,
   7936530,   8150618,   8366890,   8587531,   8812541,   9039736,   9273485,   9509418,
   9749721,   9992207,  10241248,  10492473,  10750252,  11010216,  11274548,  11543250,
  11816321,  12093761,  12375570,  12661748,  12952295,  13247212,  13546497,  13850152,
  14160361,  14472754,  14789516,  15110647,  15438332,  15770386,  16104625,  16445417,
  16792763,  17142294,  17498379,  17856647,  18221470,  18592846,  18966407,  19346522,
  19731006,  20122043,  20517450,  20917225,  21323555,  21734253,  22149321,  22570942,
  22996933,  23429477,  23866390,  24307673,  24755509,  25209899,  25668658,  26133971,
  26603652,  27077703,  27560493,  28047651,  28539178,  29037260,  29541895,  30053083,
  30568641,  31088568,  31617233,  32150267,  32689855,  33235997,  33786508,  34345757,
  34909375,  35477362,  36054088,  36637367,  37225016,  37819218,  38419973,  39027283,
  39641146,  40261563,  40888534,  41519874,  42159952,  42806583,  43459769,  44117323,
  44783616,  45456463,  46135863,  46821817,  47514325,  48213386,  48919001,  49633354,
  50352077,  51079537,  51813552,  52554120,  53303426,  54057102,  54819515,  55588483,
  56366189,  57148264,  57939077,  58738628,  59542549,  60355207,  61176604,  62002371,
  62839060,  63680118,  64529914,  65388449,  66253537,  67125179,  68005560,  68892494,
  69788166,  70692577,  71603541,  72521059,  73449500,  74382310,  75326043,  76276329,
  77233169,  78200932,  79175249,  80156120,  81147913,  82146260,  83153345,  84166984,
  85189361,  86222661,  87262515,  88308922,  89366253,  90430137,  91502759,  92586304,
  93676403,  94773055,  95880631,  96996944,  98121996,  99253601, 100396130, 101547396,
 102705217, 103873960, 105051441, 106235477, 107430434, 108634131, 109846565, 111067738,
 112299834, 113538483, 114788055, 116044181, 117311230, 118587016, 119873726, 121166990,
 122471176, 123784101, 125107948, 126438349, 127779673, 129131920, 130490720, 131860444,
 133241090, 134628289, 136028597, 137435458, 138853241, 140281948, 141719393, 143165576,
};


uint16_t valToPwm12(int val, int brightness) {
    if (val<0) val=0;
    if (val>255) val=255;
    return ((uint32_t)brightness*lumConvTab[val])>>20;
}

#endif
